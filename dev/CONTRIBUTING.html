<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Contributing to dm • dm</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" sizes="any" href="favicon.ico"><link rel="manifest" href="site.webmanifest"><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Fira_Mono-0.4.9/font.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="Contributing to dm"><meta property="og:image" content="https://dm.cynkra.com/logo.png"><meta name="robots" content="noindex"><script defer data-domain="dm.cynkra.com" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-nav" alt="cynkra"></a>
    <a class="navbar-brand me-2" href="index.html">dm</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.11.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="articles/dm.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials"><li><a class="dropdown-item" href="articles/howto-dm-theory.html">Introduction to relational data models</a></li>
    <li><a class="dropdown-item" href="articles/howto-dm-df.html">Create a dm object from data frames</a></li>
    <li><a class="dropdown-item" href="articles/howto-dm-db.html">Create a dm object from a database</a></li>
    <li><a class="dropdown-item" href="articles/howto-dm-copy.html">Copy data to and from a database</a></li>
    <li><a class="dropdown-item" href="articles/howto-dm-rows.html">Insert, update, or remove rows in a database</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="articles/cheatsheet.html">Cheatsheet</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical-articles"><li><a class="dropdown-item" href="articles/tech-dm-draw.html">Visualizing dm objects</a></li>
    <li><a class="dropdown-item" href="articles/tech-dm-keyed.html">Manipulating individual tables</a></li>
    <li><a class="dropdown-item" href="articles/tech-dm-join.html">Joining in relational data models</a></li>
    <li><a class="dropdown-item" href="articles/tech-dm-filter.html">Filtering in relational data models</a></li>
    <li><a class="dropdown-item" href="articles/tech-dm-zoom.html">Zooming and manipulating tables</a></li>
    <li><a class="dropdown-item" href="articles/tech-dm-low-level.html">Model verification - keys, constraints and normalization</a></li>
    <li><a class="dropdown-item" href="articles/tech-dm-class.html">Class 'dm' and basic operations</a></li>
    <li><a class="dropdown-item" href="articles/tech-dm-naming.html">Function naming logic</a></li>
    <li><a class="dropdown-item" href="articles/tech-dm-cdm.html">Migration guide: 'cdm' -&gt; 'dm'</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cynkra/dm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="logo.png" class="logo" alt=""><h1>Contributing to dm</h1>
      <small class="dont-index">Source: <a href="https://github.com/cynkra/dm/blob/main/.github/CONTRIBUTING.md" class="external-link"><code>.github/CONTRIBUTING.md</code></a></small>
    </div>

<div id="contributing-to-dm" class="section level1">

<p>This outlines how to propose a change to dm and how to set up a local development environment with test databases.</p>
<div class="section level2">
<h2 id="fixing-typos">Fixing typos<a class="anchor" aria-label="anchor" href="#fixing-typos"></a></h2>
<p>You can fix typos, spelling mistakes, or grammatical errors in the documentation directly using the GitHub web interface, as long as the changes are made in the <em>source</em> file. This generally means you’ll need to edit <a href="https://roxygen2.r-lib.org/articles/roxygen2.html" class="external-link">roxygen2 comments</a> in an <code>.R</code>, not a <code>.Rd</code> file. You can find the <code>.R</code> file that generates the <code>.Rd</code> by reading the comment in the first line.</p>
</div>
<div class="section level2">
<h2 id="bigger-changes">Bigger changes<a class="anchor" aria-label="anchor" href="#bigger-changes"></a></h2>
<p>If you want to make a bigger change, it’s a good idea to first file an issue and make sure someone from the team agrees that it’s needed. If you’ve found a bug, please file an issue that illustrates the bug with a minimal <a href="https://www.tidyverse.org/help/#reprex" class="external-link">reprex</a> (this will also help you write a unit test, if needed).</p>
<div class="section level3">
<h3 id="pull-request-process">Pull request process<a class="anchor" aria-label="anchor" href="#pull-request-process"></a></h3>
<ul><li><p>Fork the package and clone onto your computer. If you haven’t done this before, we recommend using <code>usethis::create_from_github("cynkra/dm", fork = TRUE)</code>.</p></li>
<li><p>Install all development dependencies with <code>devtools::install_dev_deps()</code>, and then make sure the package passes R CMD check by running <code>devtools::check()</code>. If R CMD check doesn’t pass cleanly, it’s a good idea to ask for help before continuing.</p></li>
<li><p>Create a Git branch for your pull request (PR). We recommend using <code>usethis::pr_init("brief-description-of-change")</code>.</p></li>
<li><p>Make your changes, commit to git, and then create a PR by running <code><a href="https://usethis.r-lib.org/reference/pull-requests.html" class="external-link">usethis::pr_push()</a></code>, and following the prompts in your browser. The title of your PR should briefly describe the change. The body of your PR should contain <code>Fixes #issue-number</code>.</p></li>
<li><p>For user-facing changes, add a bullet to the top of <code>NEWS.md</code> (i.e. just below the first header). Follow the style described in <a href="https://style.tidyverse.org/news.html" class="external-link uri">https://style.tidyverse.org/news.html</a>.</p></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="code-style--design">Code style &amp; design<a class="anchor" aria-label="anchor" href="#code-style--design"></a></h2>
<div class="section level3">
<h3 id="general-remarks">General remarks<a class="anchor" aria-label="anchor" href="#general-remarks"></a></h3>
<ul><li><p>New code should follow the tidyverse <a href="https://style.tidyverse.org" class="external-link">style guide</a>. You can use the <a href="https://CRAN.R-project.org/package=styler" class="external-link">styler</a> package to apply these styles, but please don’t restyle code that has nothing to do with your PR.</p></li>
<li><p>We use <a href="https://cran.r-project.org/package=roxygen2" class="external-link">roxygen2</a>, with <a href="https://cran.r-project.org/web/packages/roxygen2/vignettes/rd-formatting.html" class="external-link">Markdown syntax</a>, for documentation.</p></li>
<li><p>We use a specific <a href="https://github.com/r-lib/downlit/tree/f-readme-document" class="external-link">branch of downlit</a> for knitting the README.</p></li>
</ul></div>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<ul><li><p>We use {testthat}.</p></li>
<li><p>All exported functions should be tested.</p></li>
<li><p>R scripts under “tests/testthat/”” whose name start with <a href="https://blog.r-hub.io/2020/11/18/testthat-utility-belt/#code-called-in-your-tests" class="external-link">“helper”</a> are loaded with <code>devtools::load_all()</code> so they are available for both tests and interactive debugging, but can’t be found with <code>:::</code>.</p></li>
<li><p>“helper-src.R” implements a complex mechanism so that some dm creating functions, such as <code>dm_for_filter()</code>, will create a remote dm in a different database management system depending on context. This allows tests that use those to be run on different setups through github actions. Additionally <code>my_db_test_src()</code> will return the relevant database. In order to test databases locally (typically to debug if CI tests fails and we can’t debug from the online log) we can set the environ variable “DM_TEST_SRC” to “postgres”, “mariadb”, “mssql”, “duckdb” or “sqlite”. You might have to setup credentials in “helper-config-db.R” to do so.</p></li>
<li><p>Some useful expectations can be found in “helper-expectations.R”.</p></li>
<li><p>In “helper-skip.R” are some helpers to skip tests in some contexts, these might be useful for instance if a feature is not supported on some databases.</p></li>
<li><p>When using <code>expect_snapshot()</code> on a DBMS dependent call (i.e a call that uses <code>dm_for_filter()</code> or copies to <code>my_db_test_src()</code>), the <code>variant</code> argument should be set to <code>my_test_src_name</code> (a global variable created when loading helpers) so that the snapshots end up in different directories.</p></li>
</ul></div>
<div class="section level3">
<h3 id="function-naming">Function naming<a class="anchor" aria-label="anchor" href="#function-naming"></a></h3>
<p>See vignette <a href="https://cynkra.github.io/dm/articles/tech-dm-naming.html" class="external-link">function naming logic</a>.</p>
</div>
<div class="section level3">
<h3 id="error-messages">Error messages<a class="anchor" aria-label="anchor" href="#error-messages"></a></h3>
<p>We strive to standardise error messages in {dm}. A failure should be triggered by <code>abort()</code> through a function defined in “error-helpers.R” where the error class is defined with <code>dm_error_full()</code> and the error message is created by a separate function. Please follow the pattern used in <code>"error-helpers.R"</code>. Exceptions might exist but they are mostly waiting to be harmonised.</p>
</div>
</div>
<div class="section level2">
<h2 id="test-databases">Test databases<a class="anchor" aria-label="anchor" href="#test-databases"></a></h2>
<p>This repository comes with a <code>docker-compose.yml</code> file that sets up the databases required for testing. All shell commands are expected to be run from the top-level directory of a clone of this repository.</p>
<div class="section level3">
<h3 id="macos-only-install-colima-to-run-docker-containers">macOS only: Install colima to run Docker containers<a class="anchor" aria-label="anchor" href="#macos-only-install-colima-to-run-docker-containers"></a></h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">brew</span> install colima docker-compose</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">colima</span> start <span class="at">-c</span> 4 <span class="at">-m</span> 4 <span class="at">--vm-type</span> vz <span class="at">--vz-rosetta</span> <span class="at">--network-address</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="ex">colima</span> status</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#  INFO[0000] colima is running using macOS Virtualization.Framework</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#  INFO[0000] arch: aarch64</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#  INFO[0000] runtime: docker</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#  INFO[0000] mountType: virtiofs</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#  INFO[0000] address: 192.168.64.2</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#  INFO[0000] socket: unix:///Users/kirill/.colima/default/docker.sock</span></span></code></pre></div>
<p>Take note of the <code>address</code> in the output, it will be used later.</p>
<p>See also <a href="https://docs.google.com/document/d/1axInaYK6oK6riRio72uTAeQazuork1X0clY9UL9gYoE/edit?usp=sharing" class="external-link uri">https://docs.google.com/document/d/1axInaYK6oK6riRio72uTAeQazuork1X0clY9UL9gYoE/edit?usp=sharing</a> for more details on colima.</p>
</div>
<div class="section level3">
<h3 id="mssql-odbc-drivers">mssql: ODBC drivers<a class="anchor" aria-label="anchor" href="#mssql-odbc-drivers"></a></h3>
<ul><li><p>Linux: <a href="https://learn.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-ver16&amp;tabs=ubuntu18-install%2Calpine17-install%2Cdebian8-install%2Credhat7-13-install%2Crhel7-offline" class="external-link uri">https://learn.microsoft.com/en-us/sql/connect/odbc/linux-mac/installing-the-microsoft-odbc-driver-for-sql-server?view=sql-server-ver16&amp;tabs=ubuntu18-install%2Calpine17-install%2Cdebian8-install%2Credhat7-13-install%2Crhel7-offline</a></p></li>
<li><p>macOS: <a href="https://learn.microsoft.com/en-us/sql/connect/odbc/linux-mac/install-microsoft-odbc-driver-sql-server-macos?view=sql-server-ver16" class="external-link uri">https://learn.microsoft.com/en-us/sql/connect/odbc/linux-mac/install-microsoft-odbc-driver-sql-server-macos?view=sql-server-ver16</a></p></li>
</ul></div>
<div class="section level3">
<h3 id="start-new-database-containers">Start new database containers<a class="anchor" aria-label="anchor" href="#start-new-database-containers"></a></h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">make</span> db-start</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># May take several minutes to pull the images</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="start-database-containers-without-forcing-recreation">Start database containers without forcing recreation<a class="anchor" aria-label="anchor" href="#start-database-containers-without-forcing-recreation"></a></h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">make</span> db-restart</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co"># May take several minutes to pull the images</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="connectivity-test">Connectivity test<a class="anchor" aria-label="anchor" href="#connectivity-test"></a></h3>
<p>macOS:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="va">DM_TEST_DOCKER_HOST</span><span class="op">=</span>192.168.64.2 <span class="fu">make</span> connect</span></code></pre></div>
<p>Linux:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="va">DM_TEST_DOCKER_HOST</span><span class="op">=</span>127.0.0.1 <span class="fu">make</span> connect</span></code></pre></div>
<p>Controlled with environment variables:</p>
<ul><li>
<p><code>DM_TEST_DOCKER_HOST</code>: <code>127.0.0.1</code> or <code>localhost</code> on Linux, see output of <code>colima status</code> on macOS</p>
<p>(On Linux, using <code>localhost</code> instead of <code>127.0.0.1</code> may cause problems for MariaDB.)</p>
</li>
</ul><p>See also the <code>Makefile</code>.</p>
<p>It is recommended to adapt your <code>.Renviron</code> once connectivity has been established. The subsequent instructions omit setting the environment variables explicitly.</p>
</div>
<div class="section level3">
<h3 id="test-against-a-specific-database-backend">Test against a specific database backend<a class="anchor" aria-label="anchor" href="#test-against-a-specific-database-backend"></a></h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">make</span> test-postgres</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="test-against-all-backends">Test against all backends<a class="anchor" aria-label="anchor" href="#test-against-all-backends"></a></h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">make</span> <span class="at">-j1</span> test</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="test-on-docker">Test on Docker<a class="anchor" aria-label="anchor" href="#test-on-docker"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># make docker-build # not necessary, image available on ghcr.io</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">make</span> docker-test</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a></h2>
<p>Please note that the dm project is released with a <a href="CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project you agree to abide by its terms.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://cynkra.com/about/" class="external-link">Tobias Schieferdecker</a>, <a href="http://krlmlr.info" class="external-link">Kirill Müller</a>, Darko Bergant, <a href="https://www.energie360.ch/de/" class="external-link"><img src="https://cynkra.github.io/dm/reference/figures/energie-72.png" height="16" alt="energie360° AG"></a>, <a href="https://www.cynkra.com" class="external-link"><img src="https://cynkra.github.io/dm/reference/figures/cynkra-72.png" height="16" alt="cynkra GmbH"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>
Sponsored by <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-footer" alt="cynkra"></a>
</p>
</div>

    </footer></div>





  </body></html>

