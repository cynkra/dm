<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dm">
<title>Joining in relational data models • dm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Mono-0.4.2/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Joining in relational data models">
<meta property="og:description" content="dm">
<meta property="og:image" content="https://cynkra.github.io/dm/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="dm.cynkra.com" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-nav" alt="cynkra"></a>
    <a class="navbar-brand me-2" href="../index.html">dm</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.3.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/dm.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/howto-dm-theory.html">Introduction to relational data models</a>
    <a class="dropdown-item" href="../articles/howto-dm-df.html">Create a dm object from data frames</a>
    <a class="dropdown-item" href="../articles/howto-dm-db.html">Create a dm object from a database</a>
    <a class="dropdown-item" href="../articles/howto-dm-copy.html">Copy data to and from a database</a>
    <a class="dropdown-item" href="../articles/howto-dm-rows.html">Insert, update, or remove rows in a database</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-technical-articles">Technical articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-technical-articles">
    <a class="dropdown-item" href="../articles/tech-dm-join.html">Joining in relational data models</a>
    <a class="dropdown-item" href="../articles/tech-dm-keyed.html">Manipulating individual tables</a>
    <a class="dropdown-item" href="../articles/tech-dm-zoom.html">Zooming and manipulating tables</a>
    <a class="dropdown-item" href="../articles/tech-dm-filter.html">Filtering in relational data models</a>
    <a class="dropdown-item" href="../articles/tech-dm-draw.html">Visualizing dm objects</a>
    <a class="dropdown-item" href="../articles/tech-dm-low-level.html">Model verification - keys, constraints and normalization</a>
    <a class="dropdown-item" href="../articles/tech-dm-class.html">Class 'dm' and basic operations</a>
    <a class="dropdown-item" href="../articles/tech-dm-naming.html">Function naming logic</a>
    <a class="dropdown-item" href="../articles/tech-dm-cdm.html">Migration guide: 'cdm' -&gt; 'dm'</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cynkra/dm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Joining in relational data models</h1>
                        <h4 data-toc-skip class="author">Katharina
Brunner</h4>
            
            <h4 data-toc-skip class="date">2022-11-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cynkra/dm/blob/HEAD/vignettes/tech-dm-join.Rmd" class="external-link"><code>vignettes/tech-dm-join.Rmd</code></a></small>
      <div class="d-none name"><code>tech-dm-join.Rmd</code></div>
    </div>

    
    
<p>The {dm} package offers functions to work with relational data models
in R. A common task for multiple, separated tables that have a shared
attribute is merging the data.</p>
<p>This document introduces you to the joining functions of {dm} and
shows how to apply them using data from the <a href="https://github.com/tidyverse/nycflights13" class="external-link">{nycflights13}</a>
package.</p>
<p><a href="https://dm.cynkra.com/articles/howto-dm-theory#model" class="external-link">Relational
data models</a> consist of multiple tables that are linked with <a href="https://dm.cynkra.com/articles/howto-dm-theory#fk" class="external-link">foreign
keys</a>. They are the building blocks for joining tables. Read more
about relational data models in the vignette <a href="https://dm.cynkra.com/articles/howto-dm-theory" class="external-link">“Introduction to
Relational Data Models”</a>.</p>
<p>First, we load the packages that we need:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dm.cynkra.com/" class="external-link">dm</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="data-nycflights13">Data: nycflights13<a class="anchor" aria-label="anchor" href="#data-nycflights13"></a>
</h2>
<p>To explore filtering with {dm}, we’ll use the {nycflights13} data
with its tables <code>flights</code>, <code>planes</code>,
<code>airlines</code> and <code>airports</code>.</p>
<p>This dataset contains information about the 336,776 flights that
departed from New York City in 2013, with 3,322 different planes and
1,458 airports involved. The data comes from the US Bureau of
Transportation Statistics, and is documented in
<code><a href="https://dbplyr.tidyverse.org/reference/nycflights13.html" class="external-link">?nycflights13</a></code>.</p>
<p>First, we have to create a <code>dm</code> object from the
{nycflights13} data. This is implemented with
<code><a href="../reference/dm_nycflights13.html">dm_nycflights13()</a></code>.</p>
<p>A <a href="https://dm.cynkra.com/articles/tech-dm-class.html" class="external-link">data
model object</a> contains the data as well as metadata.</p>
<p>If you would like to create a <code>dm</code> from other tables,
please look at <code><a href="../reference/dm.html">?dm</a></code> and the function
<code><a href="../reference/dm.html">new_dm()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dm_nycflights13.html">dm_nycflights13</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="join">Joining a <code>dm</code> object<a class="anchor" aria-label="anchor" href="#join"></a>
</h2>
<p>{dm} allows you to join two tables of a <code>dm</code> object based
on a shared column. You can use all join functions that you know from
the {dplyr} package. Currently {dplyr} supports four types of mutating
joins, two types of filtering joins, and a nesting join. See
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">?dplyr::join</a></code> for details.</p>
<div class="section level3">
<h3 id="how-it-works">How it works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h3>
<p>A join is the combination of two tables based on shared information.
In technical terms, we merge the tables that need to be directly
connected by a <a href="https://dm.cynkra.com/articles/howto-dm-theory#fk" class="external-link">foreign key
relation</a>.</p>
<p>The existing links can be inspected in two ways:</p>
<ol style="list-style-type: decimal">
<li>Visually, by drawing the data model with <code><a href="../reference/dm_draw.html">dm_draw()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_draw.html">dm_draw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><!-- Generated by graphviz version 2.40.1 (20161225.0304)
 --><!-- Title: %0 Pages: 1 --><svg width="250pt" height="230pt" viewbox="0.00 0.00 250.00 230.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 226)"><title>%0</title>
<g id="a_graph0"><a xlink:title="Data Model">
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-226 246,-226 246,4 -4,4"></polygon></a>
</g><!-- airlines --><g id="airlines" class="node"><title>airlines</title>
<polygon fill="#ed7d31" stroke="transparent" points="168.5,-201 168.5,-221 213.5,-221 213.5,-201 168.5,-201"></polygon><text text-anchor="start" x="170.3969" y="-206.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">airlines</text><polygon fill="#fbe5d5" stroke="transparent" points="168.5,-181 168.5,-201 213.5,-201 213.5,-181 168.5,-181"></polygon><text text-anchor="start" x="170.5" y="-187.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">carrier</text><polygon fill="none" stroke="#9e5320" stroke-opacity="0.666667" points="167,-180 167,-222 214,-222 214,-180 167,-180"></polygon></g><!-- airports --><g id="airports" class="node"><title>airports</title>
<polygon fill="#ed7d31" stroke="transparent" points="167.5,-81 167.5,-101 213.5,-101 213.5,-81 167.5,-81"></polygon><text text-anchor="start" x="169.1192" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">airports</text><polygon fill="#fbe5d5" stroke="transparent" points="167.5,-61 167.5,-81 213.5,-81 213.5,-61 167.5,-61"></polygon><text text-anchor="start" x="169.5" y="-67.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">faa</text><polygon fill="none" stroke="#9e5320" stroke-opacity="0.666667" points="166.5,-60 166.5,-102 214.5,-102 214.5,-60 166.5,-60"></polygon></g><!-- flights --><g id="flights" class="node"><title>flights</title>
<polygon fill="#5b9bd5" stroke="transparent" points="1.5,-141 1.5,-161 102.5,-161 102.5,-141 1.5,-141"></polygon><text text-anchor="start" x="34.1115" y="-146.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">flights</text><polygon fill="#deebf6" stroke="transparent" points="1.5,-121 1.5,-141 102.5,-141 102.5,-121 1.5,-121"></polygon><text text-anchor="start" x="3.5" y="-126.4" font-family="Times,serif" font-size="14.00" fill="#444444">carrier</text><polygon fill="#deebf6" stroke="transparent" points="1.5,-101 1.5,-121 102.5,-121 102.5,-101 1.5,-101"></polygon><text text-anchor="start" x="3.5" y="-106.4" font-family="Times,serif" font-size="14.00" fill="#444444">tailnum</text><polygon fill="#deebf6" stroke="transparent" points="1.5,-81 1.5,-101 102.5,-101 102.5,-81 1.5,-81"></polygon><text text-anchor="start" x="3.5" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#444444">origin</text><polygon fill="#deebf6" stroke="transparent" points="1.5,-61 1.5,-81 102.5,-81 102.5,-61 1.5,-61"></polygon><text text-anchor="start" x="3.0056" y="-66.4" font-family="Times,serif" font-size="14.00" fill="#444444">origin, time_hour</text><polygon fill="none" stroke="#3c678e" stroke-opacity="0.666667" points="0,-60 0,-162 103,-162 103,-60 0,-60"></polygon></g><!-- flights&#45;&gt;airlines --><g id="flights_1" class="edge"><title>flights:carrier-&gt;airlines:carrier</title>
<path fill="none" stroke="#555555" d="M102.5,-131C126.5668,-131 120.8029,-155.2496 139,-171 147.7956,-178.613 151.0394,-185.8305 158.4157,-189.1277"></path><polygon fill="#555555" stroke="#555555" points="158.0291,-192.6157 168.5,-191 159.307,-185.7333 158.0291,-192.6157"></polygon></g><!-- flights&#45;&gt;airports --><g id="flights_2" class="edge"><title>flights:origin-&gt;airports:faa</title>
<path fill="none" stroke="#555555" d="M102.5,-91C128.9473,-91 135.7361,-75.6875 157.2687,-71.8594"></path><polygon fill="#555555" stroke="#555555" points="157.8281,-75.3248 167.5,-71 157.2421,-68.3494 157.8281,-75.3248"></polygon></g><!-- planes --><g id="planes" class="node"><title>planes</title>
<polygon fill="#ed7d31" stroke="transparent" points="167.5,-141 167.5,-161 213.5,-161 213.5,-141 167.5,-141"></polygon><text text-anchor="start" x="172.6178" y="-146.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">planes</text><polygon fill="#fbe5d5" stroke="transparent" points="167.5,-121 167.5,-141 213.5,-141 213.5,-121 167.5,-121"></polygon><text text-anchor="start" x="169.1115" y="-127.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">tailnum</text><polygon fill="none" stroke="#9e5320" stroke-opacity="0.666667" points="166.5,-120 166.5,-162 214.5,-162 214.5,-120 166.5,-120"></polygon></g><!-- flights&#45;&gt;planes --><g id="flights_3" class="edge"><title>flights:tailnum-&gt;planes:tailnum</title>
<path fill="none" stroke="#555555" d="M102.5,-111C128.9473,-111 135.7361,-126.3125 157.2687,-130.1406"></path><polygon fill="#555555" stroke="#555555" points="157.2421,-133.6506 167.5,-131 157.8281,-126.6752 157.2421,-133.6506"></polygon></g><!-- weather --><g id="weather" class="node"><title>weather</title>
<polygon fill="#70ad47" stroke="transparent" points="140.5,-21 140.5,-41 241.5,-41 241.5,-21 140.5,-21"></polygon><text text-anchor="start" x="168.8492" y="-26.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">weather</text><polygon fill="#e2eeda" stroke="transparent" points="140.5,-1 140.5,-21 241.5,-21 241.5,-1 140.5,-1"></polygon><text text-anchor="start" x="142.0056" y="-7.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">origin, time_hour</text><polygon fill="none" stroke="#4a732f" stroke-opacity="0.666667" points="139,0 139,-42 242,-42 242,0 139,0"></polygon></g><!-- flights&#45;&gt;weather --><g id="flights_4" class="edge"><title>flights:origin, time_hour-&gt;weather:origin, time_hour</title>
<path fill="none" stroke="#555555" d="M102.5,-71C129.8727,-71 114.6101,-25.8792 130.6579,-13.8939"></path><polygon fill="#555555" stroke="#555555" points="131.8935,-17.1789 140.5,-11 129.9188,-10.4631 131.8935,-17.1789"></polygon></g></g></svg><p>The directed arrows show explicitly the relation between different
columns.</p>
<ol start="2" style="list-style-type: decimal">
<li>Printed to the console by calling <code><a href="../reference/dm_get_all_fks.html">dm_get_all_fks()</a></code>
</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_get_all_fks.html">dm_get_all_fks</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 4 × 5</span></span>
<span><span class="co">#&gt;   child_table child_fk_cols     parent_table parent_key_cols   on_delete</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;       &lt;keys&gt;            &lt;chr&gt;        &lt;keys&gt;            &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1 flights     carrier           airlines     carrier           no_action</span></span>
<span><span class="co">#&gt; 2 flights     origin            airports     faa               no_action</span></span>
<span><span class="co">#&gt; 3 flights     tailnum           planes       tailnum           no_action</span></span>
<span><span class="co">#&gt; 4 flights     origin, time_hour weather      origin, time_hour no_action</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="joining-examples">Joining Examples<a class="anchor" aria-label="anchor" href="#joining-examples"></a>
</h3>
<p>Let’s look at some examples:</p>
<p><strong>Add a column with airline names from the
<code>airlines</code> table to the <code>flights</code>
table.</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dm_joined</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">dm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">airlines</span>, .join <span class="op">=</span> <span class="va">left_join</span><span class="op">)</span></span>
<span><span class="va">dm_joined</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 1,761 × 20</span></span>
<span><span class="co">#&gt;     year month   day dep_time sched_dep_t…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;         &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  2013     1    10        3          2359       4     426     437     -11</span></span>
<span><span class="co">#&gt;  2  2013     1    10       16          2359      17     447     444       3</span></span>
<span><span class="co">#&gt;  3  2013     1    10      450           500     -10     634     648     -14</span></span>
<span><span class="co">#&gt;  4  2013     1    10      520           525      -5     813     820      -7</span></span>
<span><span class="co">#&gt;  5  2013     1    10      530           530       0     824     829      -5</span></span>
<span><span class="co">#&gt;  6  2013     1    10      531           540      -9     832     850     -18</span></span>
<span><span class="co">#&gt;  7  2013     1    10      535           540      -5    1015    1017      -2</span></span>
<span><span class="co">#&gt;  8  2013     1    10      546           600     -14     645     709     -24</span></span>
<span><span class="co">#&gt;  9  2013     1    10      549           600     -11     652     724     -32</span></span>
<span><span class="co">#&gt; 10  2013     1    10      550           600     -10     649     703     -14</span></span>
<span><span class="co">#&gt; # … with 1,751 more rows, 11 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span></span>
<span><span class="co">#&gt; #   name &lt;chr&gt;, and abbreviated variable names ¹​sched_dep_time,</span></span>
<span><span class="co">#&gt; #   ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code></pre>
<p>As you can see below, the <code>dm_joined</code> data frame has one
more column than the <code>flights</code> table. The difference is the
<code>name</code> column from the <code>airlines</code> table.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dm</span><span class="op">$</span><span class="va">flights</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "year"           "month"          "day"            "dep_time"      </span></span>
<span><span class="co">#&gt;  [5] "sched_dep_time" "dep_delay"      "arr_time"       "sched_arr_time"</span></span>
<span><span class="co">#&gt;  [9] "arr_delay"      "carrier"        "flight"         "tailnum"       </span></span>
<span><span class="co">#&gt; [13] "origin"         "dest"           "air_time"       "distance"      </span></span>
<span><span class="co">#&gt; [17] "hour"           "minute"         "time_hour"</span></span>
<span></span>
<span><span class="va">dm</span><span class="op">$</span><span class="va">airlines</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "carrier" "name"</span></span>
<span></span>
<span><span class="va">dm_joined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "year"           "month"          "day"            "dep_time"      </span></span>
<span><span class="co">#&gt;  [5] "sched_dep_time" "dep_delay"      "arr_time"       "sched_arr_time"</span></span>
<span><span class="co">#&gt;  [9] "arr_delay"      "carrier"        "flight"         "tailnum"       </span></span>
<span><span class="co">#&gt; [13] "origin"         "dest"           "air_time"       "distance"      </span></span>
<span><span class="co">#&gt; [17] "hour"           "minute"         "time_hour"      "name"</span></span></code></pre></div>
<p>The result is not a <code>dm</code> object anymore, but a (tibble)
data frame:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dm_joined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span></span></code></pre></div>
<p>Another example:</p>
<p><strong>Get all flights that can’t be matched with airlines
names.</strong></p>
<p>We expect the <code>flights</code> data from {nycflights13} package
to be clean and well organized, so no flights should remain. You can
check this with an <code>anti_join</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">airlines</span>, .join <span class="op">=</span> <span class="va">anti_join</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 0 × 19</span></span>
<span><span class="co">#&gt; # … with 19 variables: year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;, dep_time &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   sched_dep_time &lt;int&gt;, dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</span></span></code></pre>
<p>An example with filtering on a <code>dm</code> and then merging:</p>
<p><strong>Get all May 2013 flights from Delta Air Lines which didn’t
depart from John F. Kennedy International Airport in - and join all the
airports data into the <code>flights</code> table.</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dm_nycflights13.html">dm_nycflights13</a></span><span class="op">(</span>subset <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_filter.html">dm_filter</a></span><span class="op">(</span></span>
<span>    airlines <span class="op">=</span> <span class="op">(</span><span class="va">name</span> <span class="op">==</span> <span class="st">"Delta Air Lines Inc."</span><span class="op">)</span>,</span>
<span>    airports <span class="op">=</span> <span class="op">(</span><span class="va">name</span> <span class="op">!=</span> <span class="st">"John F Kennedy Intl"</span><span class="op">)</span>,</span>
<span>    flights <span class="op">=</span> <span class="op">(</span><span class="va">month</span> <span class="op">==</span> <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl</a></span><span class="op">(</span><span class="va">flights</span>, <span class="va">airports</span>, .join <span class="op">=</span> <span class="va">left_join</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 2,340 × 26</span></span>
<span><span class="co">#&gt;     year month   day dep_time sched_dep_t…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;         &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  2013     5     1      554           600      -6     731     756     -25</span></span>
<span><span class="co">#&gt;  2  2013     5     1      555           600      -5     819     827      -8</span></span>
<span><span class="co">#&gt;  3  2013     5     1      603           610      -7     754     809     -15</span></span>
<span><span class="co">#&gt;  4  2013     5     1      622           630      -8     848     844       4</span></span>
<span><span class="co">#&gt;  5  2013     5     1      654           700      -6     931     950     -19</span></span>
<span><span class="co">#&gt;  6  2013     5     1      655           700      -5     944    1007     -23</span></span>
<span><span class="co">#&gt;  7  2013     5     1      656           705      -9    1005    1011      -6</span></span>
<span><span class="co">#&gt;  8  2013     5     1      658           700      -2     925     928      -3</span></span>
<span><span class="co">#&gt;  9  2013     5     1      743           745      -2    1014    1004      10</span></span>
<span><span class="co">#&gt; 10  2013     5     1      755           800      -5     929    1001     -32</span></span>
<span><span class="co">#&gt; # … with 2,330 more rows, 17 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span></span>
<span><span class="co">#&gt; #   name &lt;chr&gt;, lat &lt;dbl&gt;, lon &lt;dbl&gt;, alt &lt;dbl&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   tzone &lt;chr&gt;, and abbreviated variable names ¹​sched_dep_time,</span></span>
<span><span class="co">#&gt; #   ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code></pre>
<p>See <code><a href="../articles/tech-dm-filter.html">vignette("tech-dm-filter")</a></code> for more details on
filtering.</p>
<p>A last example:</p>
<p><strong>Merge all tables into one big table.</strong></p>
<p>Sometimes you need everything in one place. In this case, you can use
the <code><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl()</a></code> function. It joins all the tables
in your <code>dm</code> object together into one wide table. All you
have to do is to specify the starting table. The following joins are
determined by the foreign key links.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dm_nycflights13.html">dm_nycflights13</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_select_tbl.html">dm_select_tbl</a></span><span class="op">(</span><span class="op">-</span><span class="va">weather</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl</a></span><span class="op">(</span>.start <span class="op">=</span> <span class="va">flights</span><span class="op">)</span></span>
<span><span class="co">#&gt; Renaming ambiguous columns: %&gt;%</span></span>
<span><span class="co">#&gt;   dm_rename(flights, year.flights = year) %&gt;%</span></span>
<span><span class="co">#&gt;   dm_rename(airlines, name.airlines = name) %&gt;%</span></span>
<span><span class="co">#&gt;   dm_rename(airports, name.airports = name) %&gt;%</span></span>
<span><span class="co">#&gt;   dm_rename(planes, year.planes = year)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 1,761 × 35</span></span>
<span><span class="co">#&gt;    year.flights month   day dep_t…¹ sched…² dep_d…³ arr_t…⁴ sched…⁵ arr_d…⁶</span></span>
<span><span class="co">#&gt;           &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1         2013     1    10       3    2359       4     426     437     -11</span></span>
<span><span class="co">#&gt;  2         2013     1    10      16    2359      17     447     444       3</span></span>
<span><span class="co">#&gt;  3         2013     1    10     450     500     -10     634     648     -14</span></span>
<span><span class="co">#&gt;  4         2013     1    10     520     525      -5     813     820      -7</span></span>
<span><span class="co">#&gt;  5         2013     1    10     530     530       0     824     829      -5</span></span>
<span><span class="co">#&gt;  6         2013     1    10     531     540      -9     832     850     -18</span></span>
<span><span class="co">#&gt;  7         2013     1    10     535     540      -5    1015    1017      -2</span></span>
<span><span class="co">#&gt;  8         2013     1    10     546     600     -14     645     709     -24</span></span>
<span><span class="co">#&gt;  9         2013     1    10     549     600     -11     652     724     -32</span></span>
<span><span class="co">#&gt; 10         2013     1    10     550     600     -10     649     703     -14</span></span>
<span><span class="co">#&gt; # … with 1,751 more rows, 26 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span></span>
<span><span class="co">#&gt; #   name.airlines &lt;chr&gt;, name.airports &lt;chr&gt;, lat &lt;dbl&gt;, lon &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   alt &lt;dbl&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;, year.planes &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   type &lt;chr&gt;, manufacturer &lt;chr&gt;, model &lt;chr&gt;, engines &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;, and abbreviated variable …</span></span></code></pre>
<p>To be more precise, <code><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl()</a></code> will join all
tables from one level of hierarchy (i.e., direct neighbors to table
<code>.start</code>). If you want to cover tables from all levels of
hierarchy, use the argument <code>recursive = TRUE</code> for
<code><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl()</a></code> instead.</p>
<p>Also, be aware that all column names need to be unique. The
<code><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl()</a></code> takes care of this by automatically
renaming the relevant columns and informs the user if any names were
changed,
e.g. <code>dm_rename(airlines, airlines.name = name)</code>.</p>
<p>If you want to merge all tables, but get a nested table in return,
use <code><a href="../reference/dm_wrap_tbl.html">dm_wrap_tbl()</a></code> with <code><a href="../reference/pull_tbl.html">pull_tbl()</a></code> instead:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dm_nycflights13.html">dm_nycflights13</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_wrap_tbl.html">dm_wrap_tbl</a></span><span class="op">(</span>root <span class="op">=</span> <span class="va">flights</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/pull_tbl.html">pull_tbl</a></span><span class="op">(</span><span class="va">flights</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 1,761 × 23</span></span>
<span><span class="co">#&gt;     year month   day dep_time sched_dep_t…¹ dep_d…² arr_t…³ sched…⁴ arr_d…⁵</span></span>
<span><span class="co">#&gt;    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;         &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  2013     1    10        3          2359       4     426     437     -11</span></span>
<span><span class="co">#&gt;  2  2013     1    10       16          2359      17     447     444       3</span></span>
<span><span class="co">#&gt;  3  2013     1    10      450           500     -10     634     648     -14</span></span>
<span><span class="co">#&gt;  4  2013     1    10      520           525      -5     813     820      -7</span></span>
<span><span class="co">#&gt;  5  2013     1    10      530           530       0     824     829      -5</span></span>
<span><span class="co">#&gt;  6  2013     1    10      531           540      -9     832     850     -18</span></span>
<span><span class="co">#&gt;  7  2013     1    10      535           540      -5    1015    1017      -2</span></span>
<span><span class="co">#&gt;  8  2013     1    10      546           600     -14     645     709     -24</span></span>
<span><span class="co">#&gt;  9  2013     1    10      549           600     -11     652     724     -32</span></span>
<span><span class="co">#&gt; 10  2013     1    10      550           600     -10     649     703     -14</span></span>
<span><span class="co">#&gt; # … with 1,751 more rows, 14 more variables: carrier &lt;chr&gt;, flight &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;,</span></span>
<span><span class="co">#&gt; #   airlines &lt;packed[,1]&gt;, airports &lt;packed[,7]&gt;, planes &lt;packed[,8]&gt;,</span></span>
<span><span class="co">#&gt; #   weather &lt;packed[,13]&gt;, and abbreviated variable names ¹​sched_dep_time,</span></span>
<span><span class="co">#&gt; #   ²​dep_delay, ³​arr_time, ⁴​sched_arr_time, ⁵​arr_delay</span></span></code></pre>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://cynkra.com/about/" class="external-link">Tobias Schieferdecker</a>, <a href="http://krlmlr.info" class="external-link">Kirill Müller</a>, Darko Bergant, <a href="https://www.energie360.ch/de/" class="external-link"><img src="https://cynkra.github.io/dm/reference/figures/energie-72.png" height="16"></a>, <a href="https://www.cynkra.com" class="external-link"><img src="https://cynkra.github.io/dm/reference/figures/cynkra-72.png" height="16"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>
Sponsored by <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-footer" alt="cynkra"></a>
</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
