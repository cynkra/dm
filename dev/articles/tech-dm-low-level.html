<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Model verification - keys, constraints and normalization • dm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Fira_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Model verification - keys, constraints and normalization">
<meta name="robots" content="noindex">
<script defer data-domain="dm.cynkra.com" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-nav" alt="cynkra"></a>
    <a class="navbar-brand me-2" href="../index.html">dm</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.11.9002</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/dm.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/howto-dm-theory.html">Introduction to relational data models</a></li>
    <li><a class="dropdown-item" href="../articles/howto-dm-df.html">Create a dm object from data frames</a></li>
    <li><a class="dropdown-item" href="../articles/howto-dm-db.html">Create a dm object from a database</a></li>
    <li><a class="dropdown-item" href="../articles/howto-dm-copy.html">Copy data to and from a database</a></li>
    <li><a class="dropdown-item" href="../articles/howto-dm-rows.html">Insert, update, or remove rows in a database</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../articles/cheatsheet.html">Cheatsheet</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-technical-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Technical articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-technical-articles">
<li><a class="dropdown-item" href="../articles/tech-dm-draw.html">Visualizing dm objects</a></li>
    <li><a class="dropdown-item" href="../articles/tech-dm-keyed.html">Manipulating individual tables</a></li>
    <li><a class="dropdown-item" href="../articles/tech-dm-join.html">Joining in relational data models</a></li>
    <li><a class="dropdown-item" href="../articles/tech-dm-filter.html">Filtering in relational data models</a></li>
    <li><a class="dropdown-item" href="../articles/tech-dm-zoom.html">Zooming and manipulating tables</a></li>
    <li><a class="dropdown-item" href="../articles/tech-dm-low-level.html">Model verification - keys, constraints and normalization</a></li>
    <li><a class="dropdown-item" href="../articles/tech-dm-class.html">Class 'dm' and basic operations</a></li>
    <li><a class="dropdown-item" href="../articles/tech-dm-naming.html">Function naming logic</a></li>
    <li><a class="dropdown-item" href="../articles/tech-dm-cdm.html">Migration guide: 'cdm' -&gt; 'dm'</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cynkra/dm/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Model verification - keys, constraints and normalization</h1>
            
            <h4 data-toc-skip class="date">2024-11-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cynkra/dm/blob/main/vignettes/tech-dm-low-level.Rmd" class="external-link"><code>vignettes/tech-dm-low-level.Rmd</code></a></small>
      <div class="d-none name"><code>tech-dm-low-level.Rmd</code></div>
    </div>

    
    
<p>In this document, we will present several specialized functions for
conducting basic tests about key conditions and about relations between
tables. We will also describe functions that can be used for splitting
and uniting tables.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dm.cynkra.com/">dm</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="testing-key-constraints">Testing key constraints<a class="anchor" aria-label="anchor" href="#testing-key-constraints"></a>
</h2>
<p>This section contains information and examples about the following
functions:</p>
<ol style="list-style-type: decimal">
<li><code>check_key(.data, ...)</code></li>
<li><code>check_subset(t1, c1, t2, c2)</code></li>
<li><code>check_set_equality(t1, c1, t2, c2)</code></li>
</ol>
<p>When you have tables (data frames) that are connected by key
relations, {dm} can help you to verify the assumed key relations and/or
determine the existing key relations between the tables. For example, if
you have tables:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span>, c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">data_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>and you want to know if <code>a</code> is a primary key for
<code>data_1</code>, you can use the <code><a href="../reference/check_key.html">check_key()</a></code>
function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_key.html">check_key</a></span><span class="op">(</span><span class="va">data_1</span>, <span class="va">a</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `abort_not_unique_key()` at dm/R/key-helpers.R:64:5:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> (`a`) not a unique key of `data_1`.</span></span></code></pre></div>
<p>Mind the error message when a test is not passed.</p>
<p>For <code>data_2</code>, column <code>a</code> is a key:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_key.html">check_key</a></span><span class="op">(</span><span class="va">data_2</span>, <span class="va">a</span><span class="op">)</span></span></code></pre></div>
<p>To see if a column of one table contains only those values that are
also present in another column of another table, the
<code><a href="../reference/check_subset.html">check_subset()</a></code> function can be used:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_subset.html">check_subset</a></span><span class="op">(</span><span class="va">data_1</span>, <span class="va">a</span>, <span class="va">data_2</span>, <span class="va">a</span><span class="op">)</span></span></code></pre></div>
<p>This function is important for determining if a column is a foreign
key to some other table. What about the inverse relation?</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_subset.html">check_subset</a></span><span class="op">(</span><span class="va">data_2</span>, <span class="va">a</span>, <span class="va">data_1</span>, <span class="va">a</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;       a</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     3</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `abort_not_subset_of()` at dm/R/key-helpers.R:240:3:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Column (`a`) of table `data_2` contains values (see examples above) that are not present in column (`a`) of table `data_1`.</span></span></code></pre>
<p>It should be kept in mind that <code><a href="../reference/check_subset.html">check_subset()</a></code> does not
test if column <code>c2</code> is a unique key of table <code>t2</code>.
In order to find out if a (child) table <code>t1</code> contains a
column <code>c1</code> that is a foreign key to a (parent) table
<code>t2</code> with the corresponding column <code>c2</code>, the
following method should be used:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_key.html">check_key</a></span><span class="op">(</span><span class="va">t2</span>, <span class="va">c2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/check_subset.html">check_subset</a></span><span class="op">(</span><span class="va">t1</span>, <span class="va">c1</span>, <span class="va">t2</span>, <span class="va">c2</span><span class="op">)</span></span></code></pre></div>
<p>To check both directions at once, and to find out if the unique
values of <code>c_1</code> in <code>t_1</code> are the same as those of
<code>c_2</code> in <code>t_2</code>, {dm} provides the function
<code><a href="../reference/check_set_equality.html">check_set_equality()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/check_set_equality.html">check_set_equality</a></span><span class="op">(</span><span class="va">data_1</span>, <span class="va">a</span>, <span class="va">data_2</span>, <span class="va">a</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 1 × 1</span></span>
<span><span class="co">#&gt;       a</span></span>
<span><span class="co">#&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1     3</span></span></code></pre>
<pre><code><span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `abort_sets_not_equal()` at dm/R/key-helpers.R:190:5:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Column (`a`) of table `data_2` contains values (see examples above) that are not present in column (`a`) of table `data_1`.</span></span></code></pre>
<p>Introducing one more table enables us to show how it looks when the
test is passed:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, b <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/check_set_equality.html">check_set_equality</a></span><span class="op">(</span><span class="va">data_1</span>, <span class="va">a</span>, <span class="va">data_3</span>, <span class="va">a</span><span class="op">)</span></span></code></pre></div>
<p>If the test is passed, the return value of the function will be the
first table parameter (invisibly). This ensures that the functions can
be conveniently used in a pipe configuration.</p>
</div>
<div class="section level2">
<h2 id="testing-cardinalities-between-two-tables">Testing cardinalities between two tables<a class="anchor" aria-label="anchor" href="#testing-cardinalities-between-two-tables"></a>
</h2>
<p>This section contains information and examples for the functions</p>
<ol style="list-style-type: decimal">
<li><code>check_cardinality_0_n(parent_table, primary_key_column, child_table, foreign_key_column)</code></li>
<li><code>check_cardinality_1_n(parent_table, primary_key_column, child_table, foreign_key_column)</code></li>
<li><code>check_cardinality_0_1(parent_table, primary_key_column, child_table, foreign_key_column)</code></li>
<li><code>check_cardinality_1_1(parent_table, primary_key_column, child_table, foreign_key_column)</code></li>
<li><code>examine_cardinality(parent_table, primary_key_column, child_table, foreign_key_column)</code></li>
</ol>
<p>The four functions for testing for a specific kind of cardinality of
the relation all require a parent table and a child table as inputs. The
functions first test if that requirement is fulfilled by checking
if:</p>
<ol style="list-style-type: decimal">
<li>
<code>primary_key_column</code> is a unique key for
<code>parent_table</code>
</li>
<li>The set of values of <code>foreign_key_column</code> is a subset of
the set of values of <code>primary_key_column</code>
</li>
</ol>
<p>The cardinality specifications <code>0_n</code>, <code>1_n</code>,
<code>0_1</code>, <code>1_1</code> refer to the expected relation that
the child table has with the parent table. The numbers ‘0’, ‘1’ and ‘n’
refer to the number of values in the child table’s column
(<code>foreign_key_column</code>) that correspond to each value of the
parent table’s column (<code>primary_key_column</code>). ‘n’ means more
than one in this context, with no upper limit.</p>
<p><code>0_n</code> means, that for each value of the
<code>parent_key_column</code>, the number of corresponding records in
the child table is unrestricted. <code>1_n</code> means, that for each
value of the <code>parent_key_column</code> there is at least one
corresponding record in the child table. This means that there is a
“surjective” relation from the child table to the parent table w.r.t.
the specified columns, i.e. for each parent table column value there
exists at least one equal child table column value.</p>
<p><code>0_1</code> means, that for each value of the
<code>parent_key_column</code>, at least zero and at most one value has
to correspond to it in the column of the child table. This means that
there is an “injective” relation from the child table to the parent
table w.r.t. the specified columns, i.e. no parent table column value is
addressed multiple times. But not all of the parent table column values
have to be referred to.</p>
<p><code>1_1</code> means, that for each value of the
<code>parent_key_column</code>, exactly one value has to correspond to
it in the child table’s column. This means that there is a “bijective”
(“injective” AND “surjective”) relation between the child table and the
parent table w.r.t. the specified columns, i.e. the set of values of the
two columns is equal and there are no duplicates in either of them.</p>
<p>Also <code><a href="../reference/examine_cardinality.html">examine_cardinality()</a></code> first performs the above
mentioned tests to figure out, if the parent-child table relationship
criteria are met. Subsequently, two further checks are made to determine
the nature of the relation (surjective, injective, bijective, or none of
these) between the two columns.</p>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>Given the following three data frames:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>c <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">d3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>c <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">d4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here are some examples of how the cardinality testing functions can
be used:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># This does not pass, `c` is not unique key of d2:</span></span>
<span><span class="fu"><a href="../reference/examine_cardinality.html">check_cardinality_0_n</a></span><span class="op">(</span><span class="va">d2</span>, <span class="va">c</span>, <span class="va">d1</span>, <span class="va">a</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `abort_not_unique_key()` at dm/R/key-helpers.R:64:5:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> (`c`) not a unique key of `d2`.</span></span>
<span></span>
<span><span class="co"># This passes, multiple values in d2$c are allowed:</span></span>
<span><span class="fu"><a href="../reference/examine_cardinality.html">check_cardinality_0_n</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">a</span>, <span class="va">d2</span>, <span class="va">c</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># This does not pass, injectivity is violated:</span></span>
<span><span class="fu"><a href="../reference/examine_cardinality.html">check_cardinality_1_1</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">a</span>, <span class="va">d2</span>, <span class="va">c</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `abort_not_bijective()` at dm/R/check-cardinalities.R:155:3:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> 1..1 cardinality (bijectivity) is not given: Column (`c`) in table `d2` contains duplicate values.</span></span>
<span></span>
<span><span class="co"># This passes:</span></span>
<span><span class="fu"><a href="../reference/examine_cardinality.html">check_cardinality_0_1</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">a</span>, <span class="va">d3</span>, <span class="va">c</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/examine_cardinality.html">examine_cardinality()</a></code> returns the type of relation,
e.g.:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/examine_cardinality.html">examine_cardinality</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">a</span>, <span class="va">d3</span>, <span class="va">c</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "injective mapping (child: 0 or 1 -&gt; parent: 1)"</span></span>
<span><span class="fu"><a href="../reference/examine_cardinality.html">examine_cardinality</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">a</span>, <span class="va">d2</span>, <span class="va">c</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "surjective mapping (child: 1 to n -&gt; parent: 1)"</span></span>
<span><span class="fu"><a href="../reference/examine_cardinality.html">examine_cardinality</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">a</span>, <span class="va">d1</span>, <span class="va">a</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "bijective mapping (child: 1 -&gt; parent: 1)"</span></span>
<span><span class="fu"><a href="../reference/examine_cardinality.html">examine_cardinality</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">a</span>, <span class="va">d4</span>, <span class="va">a</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "generic mapping (child: 0 to n -&gt; parent: 1)"</span></span></code></pre></div>
<p>Just like the underlying cardinality functions, it will also inform
you if any restrictions on cardinality are violated:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/examine_cardinality.html">examine_cardinality</a></span><span class="op">(</span><span class="va">d2</span>, <span class="va">c</span>, <span class="va">d1</span>, <span class="va">a</span><span class="op">)</span></span>
<span><span class="co">#&gt; Column (`c`) not a unique key of `d2`.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="table-surgery">Table surgery<a class="anchor" aria-label="anchor" href="#table-surgery"></a>
</h2>
<p>The relevant functions are:</p>
<ol style="list-style-type: decimal">
<li><code>decompose_table(.data, new_id_column, ...)</code></li>
<li><code>reunite_parent_child(child_table, parent_table, id_column)</code></li>
<li><code>reunite_parent_child_from_list(list_of_parent_child_tables, id_column)</code></li>
</ol>
<p>The first function implements table normalization. An existing table
is split into a parent table (i.e. a lookup table) and a child table
(containing the observations), linked by a key column (here:
<code>new_id_column</code>). Basically, a foreign key relation would be
created, pointing from the <code>new_id_column</code> of the child table
to the parent table’s corresponding column, which can be seen as the
parent table’s primary key column. The function
<code><a href="../reference/decompose_table.html">decompose_table()</a></code> does that, as can be seen in the
following example:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mtcars_tibble</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">mtcars_tibble</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 32 × 11</span></span>
<span><span class="co">#&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4</span></span>
<span><span class="co">#&gt;  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4</span></span>
<span><span class="co">#&gt;  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1</span></span>
<span><span class="co">#&gt;  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1</span></span>
<span><span class="co">#&gt;  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2</span></span>
<span><span class="co">#&gt;  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1</span></span>
<span><span class="co">#&gt;  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4</span></span>
<span><span class="co">#&gt;  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2</span></span>
<span><span class="co">#&gt;  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2</span></span>
<span><span class="co">#&gt; 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4</span></span>
<span><span class="co">#&gt; # ℹ 22 more rows</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">decomposed_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decompose_table.html">decompose_table</a></span><span class="op">(</span><span class="va">mtcars_tibble</span>, <span class="va">am_gear_carb_id</span>, <span class="va">am</span>, <span class="va">gear</span>, <span class="va">carb</span><span class="op">)</span></span>
<span><span class="va">decomposed_table</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; $child_table</span></span>
<span><span class="co">#&gt; # A tibble: 32 × 9</span></span>
<span><span class="co">#&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs am_gear_carb_id</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;           &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1  21       6  160    110  3.9   2.62  16.5     0               7</span></span>
<span><span class="co">#&gt;  2  21       6  160    110  3.9   2.88  17.0     0               7</span></span>
<span><span class="co">#&gt;  3  22.8     4  108     93  3.85  2.32  18.6     1               8</span></span>
<span><span class="co">#&gt;  4  21.4     6  258    110  3.08  3.22  19.4     1               1</span></span>
<span><span class="co">#&gt;  5  18.7     8  360    175  3.15  3.44  17.0     0               2</span></span>
<span><span class="co">#&gt;  6  18.1     6  225    105  2.76  3.46  20.2     1               1</span></span>
<span><span class="co">#&gt;  7  14.3     8  360    245  3.21  3.57  15.8     0               3</span></span>
<span><span class="co">#&gt;  8  24.4     4  147.    62  3.69  3.19  20       1               4</span></span>
<span><span class="co">#&gt;  9  22.8     4  141.    95  3.92  3.15  22.9     1               4</span></span>
<span><span class="co">#&gt; 10  19.2     6  168.   123  3.92  3.44  18.3     1               5</span></span>
<span><span class="co">#&gt; # ℹ 22 more rows</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $parent_table</span></span>
<span><span class="co">#&gt; # A tibble: 13 × 4</span></span>
<span><span class="co">#&gt;    am_gear_carb_id    am  gear  carb</span></span>
<span><span class="co">#&gt;              &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1               7     1     4     4</span></span>
<span><span class="co">#&gt;  2               8     1     4     1</span></span>
<span><span class="co">#&gt;  3               1     0     3     1</span></span>
<span><span class="co">#&gt;  4               2     0     3     2</span></span>
<span><span class="co">#&gt;  5               3     0     3     4</span></span>
<span><span class="co">#&gt;  6               4     0     4     2</span></span>
<span><span class="co">#&gt;  7               5     0     4     4</span></span>
<span><span class="co">#&gt;  8               6     0     3     3</span></span>
<span><span class="co">#&gt;  9               9     1     4     2</span></span>
<span><span class="co">#&gt; 10              10     1     5     2</span></span>
<span><span class="co">#&gt; 11              11     1     5     4</span></span>
<span><span class="co">#&gt; 12              12     1     5     6</span></span>
<span><span class="co">#&gt; 13              13     1     5     8</span></span></code></pre>
<p>A new column is created, with which the two tables can be joined
again, essentially creating the original table.</p>
<p>The functions that do the inverse operation, i.e. join a parent and a
child table and subsequently drop the <code>new_id_column</code>, are
<code><a href="../reference/reunite_parent_child.html">reunite_parent_child()</a></code> and
<code><a href="../reference/reunite_parent_child.html">reunite_parent_child_from_list()</a></code>. The former takes as
arguments two tables and the unquoted name of the ID column, and the
latter takes as arguments a list of two tables plus the unquoted name of
the ID column:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parent_table</span> <span class="op">&lt;-</span> <span class="va">decomposed_table</span><span class="op">$</span><span class="va">parent_table</span></span>
<span><span class="va">child_table</span> <span class="op">&lt;-</span> <span class="va">decomposed_table</span><span class="op">$</span><span class="va">child_table</span></span>
<span><span class="fu"><a href="../reference/reunite_parent_child.html">reunite_parent_child</a></span><span class="op">(</span><span class="va">child_table</span>, <span class="va">parent_table</span>, id_column <span class="op">=</span> <span class="va">am_gear_carb_id</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # A tibble: 32 × 11</span></span>
<span><span class="co">#&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span></span>
<span><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4</span></span>
<span><span class="co">#&gt;  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4</span></span>
<span><span class="co">#&gt;  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1</span></span>
<span><span class="co">#&gt;  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1</span></span>
<span><span class="co">#&gt;  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2</span></span>
<span><span class="co">#&gt;  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1</span></span>
<span><span class="co">#&gt;  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4</span></span>
<span><span class="co">#&gt;  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2</span></span>
<span><span class="co">#&gt;  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2</span></span>
<span><span class="co">#&gt; 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4</span></span>
<span><span class="co">#&gt; # ℹ 22 more rows</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Shortcut:</span></span>
<span><span class="fu"><a href="../reference/reunite_parent_child.html">reunite_parent_child_from_list</a></span><span class="op">(</span><span class="va">decomposed_table</span>, id_column <span class="op">=</span> <span class="va">am_gear_carb_id</span><span class="op">)</span></span></code></pre></div>
<p>Currently, these functions only exist as a low-level operation on
tables. We plan to extend this operation to <code>dm</code> objects in
the future.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://cynkra.com/about/" class="external-link">Tobias Schieferdecker</a>, <a href="http://krlmlr.info" class="external-link">Kirill Müller</a>, Darko Bergant, <a href="https://www.energie360.ch/de/" class="external-link"><img src="https://cynkra.github.io/dm/reference/figures/energie-72.png" height="16" alt="energie360° AG"></a>, <a href="https://www.cynkra.com" class="external-link"><img src="https://cynkra.github.io/dm/reference/figures/cynkra-72.png" height="16" alt="cynkra GmbH"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>
Sponsored by <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.com/assets/img/logo_small.svg" id="cynkra-logo-footer" alt="cynkra"></a>
</p>
</div>

    </footer>
</div>





  </body>
</html>
