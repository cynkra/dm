<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dm">
<title>Getting started with dm • dm</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with dm">
<meta property="og:description" content="dm">
<meta property="og:image" content="https://cynkra.github.io/dm/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://cynkra.com" class="external-link"><img src="https://cynkra.github.io/dm/reference/figures/cynkra-72.png" alt="cynkra" id="navbar-logo"></a>
    <a class="navbar-brand me-2" href="../index.html">dm</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/dm.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/howto-dm-theory.html">Introduction to relational data models</a>
    <a class="dropdown-item" href="../articles/howto-dm-df.html">Create a dm object from data frames</a>
    <a class="dropdown-item" href="../articles/howto-dm-db.html">Create a dm object from a database</a>
    <a class="dropdown-item" href="../articles/howto-dm-copy.html">Copy data to and from a database</a>
    <a class="dropdown-item" href="../articles/howto-dm-rows.html">Insert, update, or remove rows in a database</a>
  </div>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-technical-articles">Technical articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-technical-articles">
    <a class="dropdown-item" href="../articles/tech-dm-join.html">Joining in relational data models</a>
    <a class="dropdown-item" href="../articles/tech-dm-keyed.html">Manipulating individual tables</a>
    <a class="dropdown-item" href="../articles/tech-dm-zoom.html">Zooming and manipulating tables</a>
    <a class="dropdown-item" href="../articles/tech-dm-filter.html">Filtering in relational data models</a>
    <a class="dropdown-item" href="../articles/tech-dm-draw.html">Visualizing dm objects</a>
    <a class="dropdown-item" href="../articles/tech-dm-low-level.html">Model verification - keys, constraints and normalization</a>
    <a class="dropdown-item" href="../articles/tech-dm-class.html">Class 'dm' and basic operations</a>
    <a class="dropdown-item" href="../articles/tech-dm-naming.html">Function naming logic</a>
    <a class="dropdown-item" href="../articles/tech-dm-cdm.html">Migration guide: 'cdm' -&gt; 'dm'</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/cynkra/dm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Getting started with dm</h1>
            
            <h4 data-toc-skip class="date">2022-07-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cynkra/dm/blob/HEAD/vignettes/dm.Rmd" class="external-link"><code>vignettes/dm.Rmd</code></a></small>
      <div class="d-none name"><code>dm.Rmd</code></div>
    </div>

    
    
<p>In this article, we’re going show you how easy it is to move from connecting to the database holding your data to producing the results you need. It’s meant to be a quick and friendly introduction to {dm}, so it is low on details and caveats. Links to detailed documentation are provided at the end. (If your data is in data frames instead of a database and you’re in a hurry, jump over to <code><a href="../articles/howto-dm-df.html">vignette("howto-dm-df")</a></code>.)</p>
<div class="section level2">
<h2 id="creating-a-dm-object">Creating a dm object<a class="anchor" aria-label="anchor" href="#creating-a-dm-object"></a>
</h2>
<p>dm objects can be created from individual tables or loaded directly from a relational data model on an RDBMS (relational database management system).</p>
<p>For this demonstration, we’re going to work with a model hosted on a public server. The first thing we need is a connection to the RDBMS hosting the data.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmariadb.r-dbi.org" class="external-link">RMariaDB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fin_db</span> <span class="op">&lt;-</span> <span class="fu">dbConnect</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rmariadb.r-dbi.org/reference/dbConnect-MariaDBDriver-method.html" class="external-link">MariaDB</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  username <span class="op">=</span> <span class="st">"guest"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"relational"</span>,</span>
<span>  dbname <span class="op">=</span> <span class="st">"Financial_ijs"</span>,</span>
<span>  host <span class="op">=</span> <span class="st">"relational.fit.cvut.cz"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rmariadb.r-dbi.org" class="external-link">RMariaDB</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fin_db</span> <span class="op">&lt;-</span> <span class="fu">dm</span><span class="fu">:::</span><span class="fu">financial_db_con</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>We create a dm object from an RDBMS using <code><a href="../reference/dm_from_con.html">dm_from_con()</a></code>, passing in the connection object we just created as the first argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cynkra.github.io/dm/">dm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fin_dm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dm_from_con.html">dm_from_con</a></span><span class="op">(</span><span class="va">fin_db</span><span class="op">)</span></span>
<span><span class="co">#&gt; Keys queried successfully, use `learn_keys = TRUE` to mute this message.</span></span>
<span><span class="va">fin_dm</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; ── Table source ───────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; src:  mysql  [guest@relational.fit.cvut.cz:NA/Financial_ijs]</span></span>
<span><span class="co">#&gt; ── Metadata ───────────────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt; Tables: `accounts`, `cards`, `clients`, `disps`, `districts`, … (9 total)</span></span>
<span><span class="co">#&gt; Columns: 57</span></span>
<span><span class="co">#&gt; Primary keys: 9</span></span>
<span><span class="co">#&gt; Foreign keys: 8</span></span></code></pre>
<p>The dm object interrogates the RDBMS for table and column information, and primary and foreign keys. Currently, primary and foreign keys are only available from SQL Server, Postgres and MariaDB.</p>
</div>
<div class="section level2">
<h2 id="selecting-tables">Selecting tables<a class="anchor" aria-label="anchor" href="#selecting-tables"></a>
</h2>
<p>The dm object can be accessed like a named list of tables:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fin_dm</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "accounts"  "cards"     "clients"   "disps"     "districts" "loans"    </span></span>
<span><span class="co">#&gt; [7] "orders"    "tkeys"     "trans"</span></span>
<span><span class="va">fin_dm</span><span class="op">$</span><span class="va">loans</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # Source:   table&lt;`Financial_ijs`.`loans`&gt; [?? x 7]</span></span>
<span><span class="co">#&gt; # Database: mysql  [guest@relational.fit.cvut.cz:NA/Financial_ijs]</span></span>
<span><span class="co">#&gt;       id account_id date       amount duration payments status</span></span>
<span><span class="co">#&gt;    &lt;int&gt;      &lt;int&gt; &lt;date&gt;      &lt;dbl&gt;    &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt; </span></span>
<span><span class="co">#&gt;  1  4959          2 1994-01-05  80952       24     3373 A     </span></span>
<span><span class="co">#&gt;  2  4961         19 1996-04-29  30276       12     2523 B     </span></span>
<span><span class="co">#&gt;  3  4962         25 1997-12-08  30276       12     2523 A     </span></span>
<span><span class="co">#&gt;  4  4967         37 1998-10-14 318480       60     5308 D     </span></span>
<span><span class="co">#&gt;  5  4968         38 1998-04-19 110736       48     2307 C     </span></span>
<span><span class="co">#&gt;  6  4973         67 1996-05-02 165960       24     6915 A     </span></span>
<span><span class="co">#&gt;  7  4986         97 1997-08-10 102876       12     8573 A     </span></span>
<span><span class="co">#&gt;  8  4988        103 1997-12-06 265320       36     7370 D     </span></span>
<span><span class="co">#&gt;  9  4989        105 1998-12-05 352704       48     7348 C     </span></span>
<span><span class="co">#&gt; 10  4990        110 1997-09-08 162576       36     4516 C     </span></span>
<span><span class="co">#&gt; # … with more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">fin_dm</span><span class="op">$</span><span class="va">trans</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # Source:   SQL [1 x 1]</span></span>
<span><span class="co">#&gt; # Database: mysql  [guest@relational.fit.cvut.cz:NA/Financial_ijs]</span></span>
<span><span class="co">#&gt;         n</span></span>
<span><span class="co">#&gt;   &lt;int64&gt;</span></span>
<span><span class="co">#&gt; 1 1056320</span></span></code></pre>
<p>Additionally, most <code>dm</code> functions are <a href="https://r4ds.had.co.nz/pipes.html" class="external-link">pipe-friendly</a> and support <a href="https://adv-r.hadley.nz/metaprogramming.html" class="external-link">tidy evaluation</a>. We can use <code>[</code> or the <code><a href="../reference/dm_select_tbl.html">dm_select_tbl()</a></code> verb to derive a smaller dm with the <code>loans</code>, <code>accounts</code>, <code>districts</code> and <code>trans</code> tables:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fin_dm_small</span> <span class="op">&lt;-</span> <span class="va">fin_dm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"loans"</span>, <span class="st">"accounts"</span>, <span class="st">"districts"</span>, <span class="st">"trans"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">fin_dm_small</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">fin_dm</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_select_tbl.html">dm_select_tbl</a></span><span class="op">(</span><span class="va">loans</span>, <span class="va">accounts</span>, <span class="va">districts</span>, <span class="va">trans</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="linking-tables-by-adding-keys">Linking tables by adding keys<a class="anchor" aria-label="anchor" href="#linking-tables-by-adding-keys"></a>
</h2>
<p>In many cases, <code><a href="../reference/dm_from_con.html">dm_from_con()</a></code> already returns a dm with all keys set. If not, dm allows us to define primary and foreign keys ourselves. For this, we use <code>learn_keys = FALSE</code> to obtain a <code>dm</code> object with only the tables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cynkra.github.io/dm/">dm</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fin_dm_small</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/dm_from_con.html">dm_from_con</a></span><span class="op">(</span><span class="va">fin_db</span>, learn_keys <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/dm_select_tbl.html">dm_select_tbl</a></span><span class="op">(</span><span class="va">loans</span>, <span class="va">accounts</span>, <span class="va">districts</span>, <span class="va">trans</span><span class="op">)</span></span></code></pre></div>
<p>In our data model, <code>id</code> columns uniquely identify records in the <code>accounts</code> and <code>loans</code> tables, and was used as a primary key. A primary key is defined with <code><a href="../reference/dm_add_pk.html">dm_add_pk()</a></code>. Each loan is linked to one account via the <code>account_id</code> column in the <code>loans</code> table, the relationship is established with <code><a href="../reference/dm_add_fk.html">dm_add_fk()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fin_dm_keys</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">fin_dm_small</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_add_pk.html">dm_add_pk</a></span><span class="op">(</span>table <span class="op">=</span> <span class="va">accounts</span>, columns <span class="op">=</span> <span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_add_pk.html">dm_add_pk</a></span><span class="op">(</span><span class="va">loans</span>, <span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_add_fk.html">dm_add_fk</a></span><span class="op">(</span>table <span class="op">=</span> <span class="va">loans</span>, columns <span class="op">=</span> <span class="va">account_id</span>, ref_table <span class="op">=</span> <span class="va">accounts</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_add_pk.html">dm_add_pk</a></span><span class="op">(</span><span class="va">trans</span>, <span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_add_fk.html">dm_add_fk</a></span><span class="op">(</span><span class="va">trans</span>, <span class="va">account_id</span>, <span class="va">accounts</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_add_pk.html">dm_add_pk</a></span><span class="op">(</span><span class="va">districts</span>, <span class="va">id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_add_fk.html">dm_add_fk</a></span><span class="op">(</span><span class="va">accounts</span>, <span class="va">district_id</span>, <span class="va">districts</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizing-a-data-model">Visualizing a data model<a class="anchor" aria-label="anchor" href="#visualizing-a-data-model"></a>
</h2>
<p>Having a diagram of the data model is the quickest way to verify we’re on the right track. We can display a visual summary of the dm at any time. The default is to display the table name, any defined keys, and their links to other tables.</p>
<p>Visualizing the dm in its current state, we can see the keys we have created and how they link the tables together. Color guides the eye.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fin_dm_keys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_set_colors.html">dm_set_colors</a></span><span class="op">(</span>darkgreen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">loans</span>, <span class="va">accounts</span><span class="op">)</span>, darkblue <span class="op">=</span> <span class="va">trans</span>, grey <span class="op">=</span> <span class="va">districts</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_draw.html">dm_draw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<?xml version="1.0" encoding="UTF-8" standalone="no"?><!-- Generated by graphviz version 2.40.1 (20161225.0304)
 --><!-- Title: %0 Pages: 1 --><svg width="263pt" height="150pt" viewbox="0.00 0.00 263.00 150.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 146)"><title>%0</title>
<g id="a_graph0"><a xlink:title="Data Model">
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-146 259,-146 259,4 -4,4"></polygon></a>
</g><!-- accounts --><g id="accounts" class="node"><title>accounts</title>
<polygon fill="#006400" stroke="transparent" points="104,-61 104,-81 164,-81 164,-61 104,-61"></polygon><text text-anchor="start" x="109.5105" y="-66.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">accounts</text><polygon fill="#cce0cc" stroke="transparent" points="104,-41 104,-61 164,-61 164,-41 104,-41"></polygon><text text-anchor="start" x="106" y="-47.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">id</text><polygon fill="#cce0cc" stroke="transparent" points="104,-21 104,-41 164,-41 164,-21 104,-21"></polygon><text text-anchor="start" x="105.6136" y="-26.4" font-family="Times,serif" font-size="14.00" fill="#444444">district_id</text><polygon fill="none" stroke="#004200" stroke-opacity="0.666667" points="103,-20 103,-82 165,-82 165,-20 103,-20"></polygon></g><!-- districts --><g id="districts" class="node"><title>districts</title>
<polygon fill="#bebebe" stroke="transparent" points="204,-41 204,-61 252,-61 252,-41 204,-41"></polygon><text text-anchor="start" x="205.8366" y="-46.4" font-family="Times,serif" font-size="14.00" fill="#000000">districts</text><polygon fill="#f2f2f2" stroke="transparent" points="204,-21 204,-41 252,-41 252,-21 204,-21"></polygon><text text-anchor="start" x="206" y="-27.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">id</text><polygon fill="none" stroke="#7e7e7e" stroke-opacity="0.666667" points="203,-20 203,-62 253,-62 253,-20 203,-20"></polygon></g><!-- accounts&#45;&gt;districts --><g id="accounts_1" class="edge"><title>accounts:district_id-&gt;districts:id</title>
<path fill="none" stroke="#555555" d="M164,-31C177.8889,-31 183.6398,-31 193.9683,-31"></path><polygon fill="#555555" stroke="#555555" points="194,-34.5001 204,-31 194,-27.5001 194,-34.5001"></polygon></g><!-- loans --><g id="loans" class="node"><title>loans</title>
<polygon fill="#006400" stroke="transparent" points="1.5,-121 1.5,-141 66.5,-141 66.5,-121 1.5,-121"></polygon><text text-anchor="start" x="19.2251" y="-126.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">loans</text><polygon fill="#cce0cc" stroke="transparent" points="1.5,-101 1.5,-121 66.5,-121 66.5,-101 1.5,-101"></polygon><text text-anchor="start" x="3.5" y="-107.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">id</text><polygon fill="#cce0cc" stroke="transparent" points="1.5,-81 1.5,-101 66.5,-101 66.5,-81 1.5,-81"></polygon><text text-anchor="start" x="3.2875" y="-86.4" font-family="Times,serif" font-size="14.00" fill="#444444">account_id</text><polygon fill="none" stroke="#004200" stroke-opacity="0.666667" points="0,-80 0,-142 67,-142 67,-80 0,-80"></polygon></g><!-- loans&#45;&gt;accounts --><g id="loans_1" class="edge"><title>loans:account_id-&gt;accounts:id</title>
<path fill="none" stroke="#555555" d="M66.5,-91C86.6802,-91 82.4424,-63.5684 94.2289,-54.1387"></path><polygon fill="#555555" stroke="#555555" points="95.5496,-57.3907 104,-51 93.4087,-50.7261 95.5496,-57.3907"></polygon></g><!-- trans --><g id="trans" class="node"><title>trans</title>
<polygon fill="#00008b" stroke="transparent" points="1.5,-41 1.5,-61 66.5,-61 66.5,-41 1.5,-41"></polygon><text text-anchor="start" x="20.3948" y="-46.4" font-family="Times,serif" font-size="14.00" fill="#ffffff">trans</text><polygon fill="#cccce7" stroke="transparent" points="1.5,-21 1.5,-41 66.5,-41 66.5,-21 1.5,-21"></polygon><text text-anchor="start" x="3.5" y="-27.4" font-family="Times,serif" text-decoration="underline" font-size="14.00" fill="#444444">id</text><polygon fill="#cccce7" stroke="transparent" points="1.5,-1 1.5,-21 66.5,-21 66.5,-1 1.5,-1"></polygon><text text-anchor="start" x="3.2875" y="-6.4" font-family="Times,serif" font-size="14.00" fill="#444444">account_id</text><polygon fill="none" stroke="#00005c" stroke-opacity="0.666667" points="0,0 0,-62 67,-62 67,0 0,0"></polygon></g><!-- trans&#45;&gt;accounts --><g id="trans_1" class="edge"><title>trans:account_id-&gt;accounts:id</title>
<path fill="none" stroke="#555555" d="M66.5,-11C86.6802,-11 82.4424,-38.4316 94.2289,-47.8613"></path><polygon fill="#555555" stroke="#555555" points="93.4087,-51.2739 104,-51 95.5496,-44.6093 93.4087,-51.2739"></polygon></g></g></svg>
</div>
<div class="section level2">
<h2 id="accessing-a-data-model-as-a-table">Accessing a data model as a table<a class="anchor" aria-label="anchor" href="#accessing-a-data-model-as-a-table"></a>
</h2>
<p>If we want to perform modeling or analysis on this relational model, we need to transform it into a tabular format that R functions can work with. With the argument <code>recursive = TRUE</code>, <code><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl()</a></code> will automatically follow foreign keys across tables to gather all the available columns into a single table.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fin_dm_keys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl</a></span><span class="op">(</span><span class="va">loans</span>, .recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Renaming ambiguous columns: %&gt;%</span></span>
<span><span class="co">#&gt;   dm_rename(loans, date.loans = date) %&gt;%</span></span>
<span><span class="co">#&gt;   dm_rename(accounts, date.accounts = date)</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # Source:   SQL [?? x 25]</span></span>
<span><span class="co">#&gt; # Database: mysql  [guest@relational.fit.cvut.cz:NA/Financial_ijs]</span></span>
<span><span class="co">#&gt;       id account…¹ date.loans amount durat…² payme…³ status distr…⁴ frequ…⁵</span></span>
<span><span class="co">#&gt;    &lt;int&gt;     &lt;int&gt; &lt;date&gt;      &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;  </span></span>
<span><span class="co">#&gt;  1  4959         2 1994-01-05  80952      24    3373 A            1 POPLAT…</span></span>
<span><span class="co">#&gt;  2  4961        19 1996-04-29  30276      12    2523 B           21 POPLAT…</span></span>
<span><span class="co">#&gt;  3  4962        25 1997-12-08  30276      12    2523 A           68 POPLAT…</span></span>
<span><span class="co">#&gt;  4  4967        37 1998-10-14 318480      60    5308 D           20 POPLAT…</span></span>
<span><span class="co">#&gt;  5  4968        38 1998-04-19 110736      48    2307 C           19 POPLAT…</span></span>
<span><span class="co">#&gt;  6  4973        67 1996-05-02 165960      24    6915 A           16 POPLAT…</span></span>
<span><span class="co">#&gt;  7  4986        97 1997-08-10 102876      12    8573 A           74 POPLAT…</span></span>
<span><span class="co">#&gt;  8  4988       103 1997-12-06 265320      36    7370 D           44 POPLAT…</span></span>
<span><span class="co">#&gt;  9  4989       105 1998-12-05 352704      48    7348 C           21 POPLAT…</span></span>
<span><span class="co">#&gt; 10  4990       110 1997-09-08 162576      36    4516 C           36 POPLAT…</span></span>
<span><span class="co">#&gt; # … with more rows, 16 more variables: date.accounts &lt;date&gt;, A2 &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   A3 &lt;chr&gt;, A4 &lt;int&gt;, A5 &lt;int&gt;, A6 &lt;int&gt;, A7 &lt;int&gt;, A8 &lt;int&gt;, A9 &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   A10 &lt;dbl&gt;, A11 &lt;int&gt;, A12 &lt;dbl&gt;, A13 &lt;dbl&gt;, A14 &lt;int&gt;, A15 &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   A16 &lt;int&gt;, and abbreviated variable names ¹​account_id, ²​duration,</span></span>
<span><span class="co">#&gt; #   ³​payments, ⁴​district_id, ⁵​frequency</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows, and `colnames()` to see all variable names</span></span></code></pre>
<p>Apart from the rows printed above, no data has been fetched from the database. Use <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> to reduce the number of columns fetched, and <code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> to retrieve the entire result for local processing.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loans_df</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">fin_dm_keys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_flatten_to_tbl.html">dm_flatten_to_tbl</a></span><span class="op">(</span><span class="va">loans</span>, .recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">amount</span>, <span class="va">duration</span>, <span class="va">A3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; Renaming ambiguous columns: %&gt;%</span></span>
<span><span class="co">#&gt;   dm_rename(loans, date.loans = date) %&gt;%</span></span>
<span><span class="co">#&gt;   dm_rename(accounts, date.accounts = date)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">amount</span> <span class="op">~</span> <span class="va">duration</span> <span class="op">+</span> <span class="va">A3</span>, data <span class="op">=</span> <span class="va">loans_df</span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = amount ~ duration + A3, data = loans_df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;     (Intercept)         duration   A3east Bohemia  A3north Bohemia  </span></span>
<span><span class="co">#&gt;           10196             4109           -16204           -28933  </span></span>
<span><span class="co">#&gt; A3north Moravia         A3Prague  A3south Bohemia  A3south Moravia  </span></span>
<span><span class="co">#&gt;            1467             4044            -1896           -12463  </span></span>
<span><span class="co">#&gt;  A3west Bohemia  </span></span>
<span><span class="co">#&gt;          -28572</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="operations-on-table-data-within-a-dm">Operations on table data within a dm<a class="anchor" aria-label="anchor" href="#operations-on-table-data-within-a-dm"></a>
</h2>
<p>We don’t need to take the extra step of exporting the data to work with it. Through the dm object, we have complete access to dplyr’s data manipulation verbs. These operate on the data within individual tables.</p>
<p>To work with a particular table we use <code><a href="../reference/dm_zoom_to.html">dm_zoom_to()</a></code> to set the context to our chosen table. Then we can perform any of the dplyr operations we want.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fin_dm_total</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">fin_dm_keys</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_zoom_to.html">dm_zoom_to</a></span><span class="op">(</span><span class="va">loans</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">account_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>total_amount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">amount</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_zoom_to.html">dm_insert_zoomed</a></span><span class="op">(</span><span class="st">"total_loans"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fin_dm_total</span><span class="op">$</span><span class="va">total_loans</span></span></code></pre></div>
<pre class="fansi fansi-output"><code><span><span class="co">#&gt; # Source:   SQL [?? x 2]</span></span>
<span><span class="co">#&gt; # Database: mysql  [guest@relational.fit.cvut.cz:NA/Financial_ijs]</span></span>
<span><span class="co">#&gt;    account_id total_amount</span></span>
<span><span class="co">#&gt;         &lt;int&gt;        &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1          2        80952</span></span>
<span><span class="co">#&gt;  2         19        30276</span></span>
<span><span class="co">#&gt;  3         25        30276</span></span>
<span><span class="co">#&gt;  4         37       318480</span></span>
<span><span class="co">#&gt;  5         38       110736</span></span>
<span><span class="co">#&gt;  6         67       165960</span></span>
<span><span class="co">#&gt;  7         97       102876</span></span>
<span><span class="co">#&gt;  8        103       265320</span></span>
<span><span class="co">#&gt;  9        105       352704</span></span>
<span><span class="co">#&gt; 10        110       162576</span></span>
<span><span class="co">#&gt; # … with more rows</span></span>
<span><span class="co">#&gt; # ℹ Use `print(n = ...)` to see more rows</span></span></code></pre>
<p>Note that, in the above example, we use <code><a href="../reference/dm_zoom_to.html">dm_insert_zoomed()</a></code> to add the results as a new table to our data model. This table is temporary and will be deleted when our session ends. If you want to make permanent changes to your data model on an RDBMS, please see the “Persisting results” section in <code><a href="../articles/howto-dm-db.html">vignette("howto-dm-db")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="checking-constraints">Checking constraints<a class="anchor" aria-label="anchor" href="#checking-constraints"></a>
</h2>
<p>It’s always smart to check that your data model follows its specifications. When building our own model or changing existing models by adding tables or keys, it is even more important that the new model is validated.</p>
<p><code>dm_examine_constrains()</code> checks all primary and foreign keys and reports if they violate their expected constraints.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fin_dm_total</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dm_examine_constraints.html">dm_examine_constraints</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre class="fansi fansi-message"><code><span><span class="co">#&gt; ℹ All constraints satisfied.</span></span></code></pre>
<p>For more on constraint checking, including cardinality, finding candidate columns for keys, and normalization, see <code><a href="../articles/tech-dm-low-level.html">vignette("tech-dm-low-level")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h2>
<p>Now that you have been introduced to the basic operation of dm, the next step is to learn more about the dm methods that your particular use case requires.</p>
<p>Is your data in an RDBMS? Then move on to <code><a href="../articles/howto-dm-db.html">vignette("howto-dm-db")</a></code> for a more detailed looking at working with an existing relational data model.</p>
<p>If your data is in data frames, then you want to read <code><a href="../articles/howto-dm-df.html">vignette("howto-dm-df")</a></code> next.</p>
<p>If you would like to know more about relational data models in order to get the most out of dm, check out <code><a href="../articles/howto-dm-theory.html">vignette("howto-dm-theory")</a></code>.</p>
<p>If you’re familiar with relational data models, but want to know how to work with them in dm, then any of <code><a href="../articles/tech-dm-join.html">vignette("tech-dm-join")</a></code>, <code><a href="../articles/tech-dm-filter.html">vignette("tech-dm-filter")</a></code>, or <code><a href="../articles/tech-dm-zoom.html">vignette("tech-dm-zoom")</a></code> is a good next step.</p>
</div>
<div class="section level2">
<h2 id="standing-on-the-shoulders-of-giants">Standing on the shoulders of giants<a class="anchor" aria-label="anchor" href="#standing-on-the-shoulders-of-giants"></a>
</h2>
<p>The {dm} package follows the tidyverse principles:</p>
<ul>
<li>
<code>dm</code> objects are immutable (your data will never be overwritten in place)</li>
<li>most functions used on <code>dm</code> objects are pipeable (i.e., return new <code>dm</code> or table objects)</li>
<li>tidy evaluation is used (unquoted function arguments are supported)</li>
</ul>
<p>The {dm} package builds heavily upon the <a href="https://github.com/bergant/datamodelr" class="external-link">{datamodelr} package</a>, and upon the <a href="https://www.tidyverse.org/" class="external-link">tidyverse</a>. We’re looking forward to a good collaboration!</p>
<p>The <a href="https://github.com/russHyde/polyply" class="external-link">{polyply} package</a> has a similar intent with a slightly different interface.</p>
<p>The <a href="https://github.com/jangorecki/data.cube" class="external-link">{data.cube} package</a> has quite the same intent using <code>array</code>-like interface.</p>
<p>Articles in the <a href="https://github.com/WinVector/rquery" class="external-link">{rquery} package</a> discuss <a href="https://github.com/WinVector/rquery/blob/master/extras/JoinController.md" class="external-link">join controllers</a> and <a href="https://github.com/WinVector/rquery/blob/master/extras/DependencySorting.md" class="external-link">join dependency sorting</a>, with the intent to move the declaration of table relationships from code to data.</p>
<p>The <a href="https://github.com/thomasp85/tidygraph" class="external-link">{tidygraph} package</a> stores a network as two related tables of <code>nodes</code> and <code>edges</code>, compatible with {dplyr} workflows.</p>
<p>In object-oriented programming languages, <a href="https://en.wikipedia.org/wiki/Object-relational_mapping" class="external-link">object-relational mapping</a> is a similar concept that attempts to map a set of related tables to a class hierarchy.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tobias Schieferdecker, <a href="http://krlmlr.info" class="external-link">Kirill Müller</a>, Darko Bergant, <a href="https://www.energie360.ch/de/" class="external-link"><img src="https://cynkra.github.io/dm/reference/figures/energie-72.png" height="16"></a>, <a href="https://www.cynkra.com" class="external-link"><img src="https://cynkra.github.io/dm/reference/figures/cynkra-72.png" height="16"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
