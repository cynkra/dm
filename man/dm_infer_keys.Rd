% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/infer-keys.R
\name{dm_infer_keys}
\alias{dm_infer_keys}
\title{Infer primary and foreign keys}
\usage{
dm_infer_keys(dm, ..., heuristics = "auto", quiet = FALSE)
}
\arguments{
\item{dm}{A \code{dm} object.}

\item{...}{These dots are for future extensions and must be empty.}

\item{heuristics}{Character vector of heuristics to use for key inference.
Use \code{"auto"} (the default) to apply all available heuristics.
Available heuristics:
\itemize{
\item \code{"column_name"}: Finds columns with identical names across tables.
If exactly one table has unique values for a column, that table gets
a primary key and other tables get foreign keys.
\item \code{"id_column"}: Matches columns named \verb{<table>_id} in child tables
to a column named \code{id} in a parent table.
Simple pluralization rules are applied to match table names
(e.g., \code{customer_id} matches the \code{customers} table).
}}

\item{quiet}{If \code{TRUE}, suppresses the message showing the equivalent code.}
}
\value{
An updated \code{dm} with inferred primary and foreign keys added.
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#experimental}{\figure{lifecycle-experimental.svg}{options: alt='[Experimental]'}}}{\strong{[Experimental]}}

\code{dm_infer_keys()} automatically infers primary and foreign key
relationships based on column naming heuristics.
Unless \code{quiet = TRUE}, the equivalent \code{dm_add_pk()} and \code{dm_add_fk()} calls
are emitted as a message.
}
\details{
The function applies the specified heuristics to detect potential
primary and foreign key relationships.
Each heuristic looks for commonly applied naming patterns:
\itemize{
\item \strong{Column name equality} (\code{"column_name"}): The most basic heuristic.
Columns with the same name in multiple tables indicate a relationship.
This works well for datasets that follow consistent naming conventions
like ADaM (Analysis Data Model) in pharmaceutical research, where
\code{USUBJID} appears across multiple tables.
\item \strong{\code{id} column pattern} (\code{"id_column"}): Detects the common pattern where
parent tables have an \code{id} primary key and child tables reference them
via \verb{<table_name>_id} columns (e.g., \code{customers.id} and \code{orders.customer_id}).
Handles both \code{snake_case} and common singular/plural forms.
}

Existing keys are preserved.
Columns where all tables have unique values (ambiguous PK) or
no table has unique values (no valid PK candidate) are skipped.
Constraint checking is not performed; use \code{\link[=dm_examine_constraints]{dm_examine_constraints()}}
to validate the inferred keys.
}
\examples{
\dontshow{if (rlang::is_installed("DiagrammeR")) withAutoprint(\{ # examplesIf}
# Create tables with a shared column
orders <- tibble::tibble(
  order_id = 1:5,
  customer_id = c(1L, 2L, 1L, 3L, 2L),
  amount = c(100, 200, 150, 300, 250)
)

customers <- tibble::tibble(
  customer_id = 1:3,
  name = c("Alice", "Bob", "Charlie")
)

# Create dm without keys
my_dm <- dm(orders, customers)

# Automatically infer and add keys
my_dm_with_keys <- dm_infer_keys(my_dm)
dm_get_all_pks(my_dm_with_keys)
dm_get_all_fks(my_dm_with_keys)

# Draw the result
dm_draw(my_dm_with_keys)
\dontshow{\}) # examplesIf}
}
\concept{key inference}
